(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{283:function(a,s,t){"use strict";t.r(s);var e=t(10),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("本文档安装的是Zookeeper的集群模式")])]),a._v(" "),s("h1",{attrs:{id:"_1、准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备工作"}},[a._v("#")]),a._v(" 1、准备工作")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("安装 "),s("code",[a._v("JDK")])])]),a._v(" "),s("li",[s("p",[a._v("上传安装包到 "),s("code",[a._v("/opt/software")]),a._v(" 目录下")])])]),a._v(" "),s("h1",{attrs:{id:"_2、解压文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、解压文件"}},[a._v("#")]),a._v(" 2、解压文件")]),a._v(" "),s("p",[a._v("将 "),s("code",[a._v("/opt/software")]),a._v(" 目录下的 "),s("code",[a._v("Zookeeper")]),a._v(" 压缩包解压到 "),s("code",[a._v("/opt/module")]),a._v(" 目录下，并修改目录名称")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/software/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 software"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxvf zookeeper-3.5.7.tar.gz -C /opt/module/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 software"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7\n")])])]),s("p",[a._v("关于 "),s("code",[a._v("Zookeeper")]),a._v(" 的环境变量配置：可以不配置环境变量，"),s("code",[a._v("Zookeeper")]),a._v(" 一般是服务于其他应用，如 "),s("code",[a._v("Hadoop")]),a._v(" 的高可用、"),s("code",[a._v("HBase")]),a._v(" 集群、"),s("code",[a._v("Kafka")]),a._v(" 集群等。如果需要操作 "),s("code",[a._v("Zookeeper")]),a._v(" ，可以直接到 "),s("code",[a._v("Zookeeper")]),a._v(" 的 "),s("code",[a._v("bin")]),a._v(" 目录下下执行命令。当然也可以配置环境变量，执行如下操作即可。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile.d/my_env.sh\n")])])]),s("p",[a._v("添加如下内容：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ZOOKEEPER_HOME")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ZOOKEEPER_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/module/zookeeper-3.5.7\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ZOOKEEPER_HOME")]),a._v("/bin\n")])])]),s("h1",{attrs:{id:"_3、修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、修改配置"}},[a._v("#")]),a._v(" 3、修改配置")]),a._v(" "),s("h2",{attrs:{id:"_3-1-配置服务器编号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-配置服务器编号"}},[a._v("#")]),a._v(" 3.1 配置服务器编号")]),a._v(" "),s("p",[a._v("在 "),s("code",[a._v("/opt/module/zookeeper-3.5.7/")]),a._v(" 这个目录下创建一个 "),s("code",[a._v("zkData")]),a._v(" 目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" zookeeper-3.5.7/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 zookeeper-3.5.7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" zkData\n")])])]),s("p",[a._v("在 "),s("code",[a._v("/opt/module/zookeeper-3.5.7/zkData")]),a._v(" 这个目录下创建一个 "),s("code",[a._v("myid")]),a._v(" 的文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 zookeeper-3.5.7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" zkData/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 zkData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" myid\n")])])]),s("p",[a._v("在文件中添加与server对应的编号：注意上下不要有空行，左右不要有空格")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2\n")])])]),s("h2",{attrs:{id:"_3-2-配置zoo-cfg文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-配置zoo-cfg文件"}},[a._v("#")]),a._v(" 3.2 配置zoo.cfg文件")]),a._v(" "),s("p",[a._v("拷贝 "),s("code",[a._v("/opt/module/zookeeper-3.5.7/conf")]),a._v("  这个目录下的 "),s("code",[a._v("zoo_sample.cfg")]),a._v(" 并重命名为 "),s("code",[a._v("zoo.cfg")]),a._v(" 并编辑")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 zkData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/conf/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" zoo_sample.cfg zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" zoo.cfg\n")])])]),s("p",[a._v("修改如下内容：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 修改数据存储路径配置\ndataDir=/opt/module/zookeeper-3.5.7/zkData\n# 增加如下配置\n#######################cluster##########################\nserver.2=hadoop102:2888:3888\nserver.3=hadoop103:2888:3888\nserver.4=hadoop104:2888:3888\n")])])]),s("p",[a._v("参数解读：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("server.A=B:C:D\n")])])]),s("ul",[s("li",[a._v("A 是一个数字，表示这个是第几号服务器；")])]),a._v(" "),s("p",[a._v("集群模式下配置一个文件 myid，这个文件在 dataDir 目录下，这个文件里面有一个数据就是 A 的值，Zookeeper 启动时读取此文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是哪个 server。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("B 是这个服务器的地址；")])]),a._v(" "),s("li",[s("p",[a._v("C 是这个服务器 Follower 与集群中的 Leader 服务器交换信息的端口；")])]),a._v(" "),s("li",[s("p",[a._v("D 是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。")])])]),a._v(" "),s("h1",{attrs:{id:"_4、同步文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、同步文件"}},[a._v("#")]),a._v(" 4、同步文件")]),a._v(" "),s("p",[a._v("将 "),s("code",[a._v("/opt/module/zookeeper-3.5.7")]),a._v(" 目录同步至另外两台服务器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ xsync zookeeper-3.5.7/\n")])])]),s("blockquote",[s("p",[a._v("注意：")]),a._v(" "),s("p",[a._v("分发文件后分别在 hadoop103、hadoop104 上修改 myid 文件中内容为 3、4。")]),a._v(" "),s("p",[a._v("如果配置了环境变量，也需要进行分发，并刷新环境变量")])]),a._v(" "),s("h1",{attrs:{id:"_5、脚本编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、脚本编写"}},[a._v("#")]),a._v(" 5、脚本编写")]),a._v(" "),s("p",[a._v("编写 "),s("code",[a._v("Zookeeper")]),a._v(" 的启停脚本并赋予执行权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" ~/bin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" zk.sh\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("laowang@hadoop102 bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" u+x zk.sh\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"start"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" hadoop102 hadoop103 hadoop104\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" ---------- zookeeper "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" 启动 ------------\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/opt/module/zookeeper-3.5.7/bin/zkServer.sh start"')]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"stop"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" hadoop102 hadoop103 hadoop104\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" ---------- zookeeper "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" 停止 ------------\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop"')]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"status"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" hadoop102 hadoop103 hadoop104\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" ---------- zookeeper "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" 状态 ------------\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/opt/module/zookeeper-3.5.7/bin/zkServer.sh status"')]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("esac")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);